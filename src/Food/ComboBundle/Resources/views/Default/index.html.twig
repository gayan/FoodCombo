<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!-->
<html lang="en">
<!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>FoodCombos - What can you create?</title>
    <meta name="description" content="" />
    <meta name="keywords" content="food, combine, combinations, goes, well, with" />
    <meta name="robots" content="index,follow" />
    <link rel="shortcut icon" href="images/favicon.ico" />
    <link rel="stylesheet" href="css/style.css" type="text/css" />
    <link rel="stylesheet" href="css/add2home.css">
    <link rel="stylesheet" href="//code.jquery.com/ui/1.10.1/themes/base/jquery-ui.css">
	<!--[if (gte IE 6)&(lte IE 8)]>
<script type="text/javascript" src="js/html5.js"></script>
<script type="text/javascript" src="js/selectivizr-min.js"></script>
<link rel="stylesheet" href="css/ie_7.css" type="text/css" />
<![endif]-->
    <script type="text/javascript" src="//code.jquery.com/jquery-1.9.1.js"></script>
    <script type="text/javascript" src="js/jquery.easing.1.3.js"></script>
    <script type="text/javascript" src="//code.jquery.com/ui/1.10.1/jquery-ui.js"></script>
    <script type="text/javascript" src="js/all-in-one.js"></script>
    <script type="text/javascript" src="js/setup.js"></script-->
	<script type="application/javascript" src="js/add2home.js"></script>
	
	<script type="text/javascript">
		$(document).ready(function() {

			var comboUtils = {
				addNewComboToDom: function(containerSelector) {
					// Create new element and add it at the top of
					// the list below
					var $newComboContainer = $('<div>', {class : 'combo-container'});
					var $newCurrentScore = $('<span>', {class : "current-score"}).html('0');					
					var $newUpButton = $('<a>', {class : 'button white'}).html('&#x25B2;');
					var $newDownButton = $('<a>', {class : 'button white'}).html('&#x25BC;');
					var $newFood1 = $('<a>', {class : 'food-name', href : '#' }).html('food1');
					var $newCombineSpan =  $('<span>', {class: 'combine'}).html('&amp;');
					var $newFood2 = $('<a>', {class: 'food-name', href: '#'}).html('food2');
					
					$newComboContainer.append($newCurrentScore);
					$newComboContainer.append($newUpButton);
					$newComboContainer.append($newDownButton);
					$newComboContainer.append($newFood1);
					$newComboContainer.append($newCombineSpan);
					$newComboContainer.append($newFood2);
					
					$newComboContainer.hide().appendTo(containerSelector).fadeIn('slow');
				},
				delay: (function(){
				  var timer = 0;
				  return function(callback, ms){
					clearTimeout (timer);
					timer = setTimeout(callback, ms);
				  };
				})(),
				searchURL: "{{ path('search') }}",
                combosURL: "{{ path('combos') }}",
                searchFood: function(response, foodName) {
                    $.ajax({
                      url: comboUtils.searchURL + '/' + foodName,
                      success: function( data ) {
                        response( $.map( data, function( item ) {
                          return {
                            label: item.food_name,
                            value: item.food_name,
                            id: item.id
                          }
                        }));
                      }
                    });
                },
				food1Name: undefined,
				food1Id: undefined,
				food2Name: undefined,
				food2Id: undefined
			};
		
			$('#add-combo-button').click(function() {
				// TODO: AJAX call to add it to the database
				
				// hide the add-combo area
				$('#add-combo').hide();
				
				comboUtils.addNewComboToDom('#combo-results');
			});
			
			$( "#food1Name" ).autocomplete({
			  source: function( request, response ) {
				comboUtils.searchFood(response, $('#food1Name').val());
			  },
			  minLength: 1,
			  select: function( event, ui ) {
				comboUtils.food1Name = this.value;
				
                if(ui.item) {
                    comboUtils.food1Id = ui.item.id
                    
                    $.getJSON(comboUtils.combosURL + '/' + ui.item.id, function(data) {
                      $('#combo-results').empty();
                      $.each(data, function() {
                        comboUtils.addNewComboToDom("#combo-results");
                      });
                    });
                    
                    $('#food2Name').focus();
                }
			  }
			});
			
			$( "#food1Name" ).focus(function(){
				comboUtils.food1Id = undefined;
				comboUtils.food1Name = undefined;
			});
			
			$( "#food1Name" ).blur(function(){
				if(comboUtils.food1Id === undefined) {
					comboUtils.food1Name = this.value;
				}
			});
            
            $( "#food2Name" ).autocomplete({
			  source: function( request, response ) {
				comboUtils.searchFood(response, $('#food2Name').val());
			  },
			  minLength: 1,
			  select: function( event, ui ) {
				comboUtils.food2Name = this.value;
				
                if(ui.item) {
                    comboUtils.food2Id = ui.item.id
                    
                    // TODO: filter the result set
                    
                    //$('#food2Name').blur();
                }
			  }
			});
            
            $( "#food2Name" ).focus(function(){
				comboUtils.food2Id = undefined;
				comboUtils.food2Name = undefined;
			});
		});
	</script>
	
	<style>
		#combo-input-form {
			text-align: center;
		}
		#combo-input-form input {
			width: 98%;
			height: 20px;
			font-size: 20px;
			margin: 0px;
			padding: 1%;
		}
		
		#add-combo .combo-container {
			border:1px solid #f2c779;
			background:#fff8c4;
			color:#ed7c18;
			font-size: 20px;
		}
		
		.combo-container {
			border:1px solid silver; /*#9ac1fa;*/
			/*background:#dbeefe;*/
			color: black;
			-webkit-border-radius:5px;
			-moz-border-radius:5px;
			border-radius:5px;
			padding:8px 10px;
			line-height:22px;
			margin-bottom:10px;
		}
		
		.combo-container a.button {
			margin: 0px 5px 0px 0px;
			cursor: pointer;
		}
		
		.combo-container .current-score {
			display: inline;
			float: left;
			line-height: 30px;
			margin-right: 5px;
			text-align: right;
			width: 30px;
		}

				
		.combo-container .food-name, .combo-container .combine {
			margin-left: 10px;
			color:#4180cf;
			font-size: 20px;
		}
		
		.combo-container .combine {
			color:#000000;
		}
		
		.combo-container .author {
			margin-left: 2px;
		}
		
		.header_bg {
			min-height: 20px;
		}
	</style>
 
    <!-- Header -->
    <header class="header_bg clearfix">
		<div class="container clearfix">
			 <!-- Logo -->
			
				<h1>FoodCombo</h1>
			
			 <!-- /Logo -->
		</div>
	</header>
    <!-- /Header -->
    
	<!-- START CONTENT -->
    <section class="container clearfix">
		
		<div class="clear padding20"></div>

		
        <div id="combo-input" class="container">
        	<form id="combo-input-form">
				<div class="col_1_3">
					<input type="text" id="food1Name" name="food1" value={{foodName1}} />
				</div>
				<div class="col_1_3">
					AND
				</div>
				<div class="col_1_3 last">
					<input type="text" id="food2Name" name="food1" />
				</div>
			</form>
        </div>
				
		<div class="clear padding20"></div>
		
		<div id="add-combo" class="container">
			<div class="combo-container">
				<a id="add-combo-button" class="button white">&#43; add to list</a>
				<a href="#" class="food-name">{{foodName1}}</a>
				<span class="combine">&amp;</span>
				<a href="#" class="food-name">Vinegar</a>
			</div>
		</div>
        
		
		<div class="clear"></div>
		<hr />
		
        <div id="combo-results" class="container">
			{% for combo in matchingCombos %}
				<div class="combo-container">
					<span class="current-score">+100</span>
					<a class="button white">&#x25B2;</a><a class="button white">&#x25BC;</a>
					<a href="#{{combo.food1.id}}" class="food-name">{{foodName1}}</a>
					<span class="combine">&amp;</span>
					<a href="#{{combo.food2.id}}" class="food-name">
					{% if combo.food1.getFoodName() == foodName1 %}
						{{combo.food2.getFoodName()}}
					{% else %}
						{{combo.food1.getFoodName()}}						
					{% endif %}
					</a>
				</div>
			{% endfor %}
		</div>
		
		<div class="clear"></div>
	
	</section>
    <!-- END CONTENT -->
	
    </div>
    <!--wrapper end-->
	
</body>
</html>
